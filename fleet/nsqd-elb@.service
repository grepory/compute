[Unit]
Description=NSQd ELB Registration
After=docker.service
Requires=docker.service
PartOf=nsqd@%i.service

[Service]
User=core
Restart=always
TimeoutStartSec=0
ExecStartPre=-/usr/bin/docker stop -t 5 %p-%i
ExecStartPre=-/usr/bin/docker rm %p-%i
ExecStartPre=/usr/bin/docker pull quay.io/coreos/elb-presence:latest
ExecStart=/usr/bin/docker run --rm --name %p-%i -e AWS_REGION=us-west-1 -e ELB_NAME=nsqd-lb quay.io/coreos/elb-presence
ExecStop=/usr/bin/docker stop -t 5 %p-%i

[X-Fleet]
MachineOf=nsqd@%i.service
